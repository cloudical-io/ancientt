version: '0'
runner:
  name: kubernetes
  kubernetes:
    kubeconfig: /home/atrost/.kube/config
    image: quay.io/galexrt/container-toolbox
    namespace: acntt
    timeouts:
      deleteTimeout: 20
      runningTimeout: 35
      succeedTimeout: 60
    hosts:
      ignoreSchedulingDisabled: true
      tolerations: []
tests:
- name: iperf3-one-rand-to-one-rand
  type: iperf3
  outputs:
  - name: csv
    csv:
      filePath: /tmp
      namePattern: 'acntt-{{ .TestStartTime }}-{{ .Data.Tester }}-{{ .Data.ServerHost }}_{{ .Data.ClientHost }}.csv'
#  - name: gochart
#    goChart:
#      types:
#        - single_axis
#      filePath: /tmp
#      namePattern: 'acntt-{{ .TestStartTime }}-{{ .Data.Tester }}-{{ .Data.ServerHost }}_{{ .Data.ClientHost }}-{{ .Extra.Type }}.csv'
#  - name: sqlite
#    sqlite:
#      filePath: /tmp
#      namePattern: 'acntt-{{ .TestStartTime }}-{{ .Data.Tester }}-{{ .Data.ServerHost }}_{{ .Data.ClientHost }}.sqlite3'
#      tableNamePattern: 'acntt{{ .TestStartTime }}{{ .Data.Tester }}{{ .Data.ServerHost }}{{ .Data.ClientHost }}'
#  - name: mysql
#    mysql:
#      dsn: "username:password@127.0.0.1/mydb"
#      tableNamePattern: 'acntt{{ .TestStartTime }}{{ .Data.Tester }}{{ .Data.ServerHost }}{{ .Data.ClientHost }}'
#      autoCreateTables: true
#  - name: excelize
#    excelize:
#      filePath: /tmp
#      namePattern: "acntt-{{ .TestStartTime }}-{{ .Data.Tester }}-{{ .Data.ServerHost }}_{{ .Data.ClientHost }}.xlsx"
#      saveAfterRows: 200 outputs mysql: added AutoCreateTables option
  runOptions:
    continueOnError: true
    rounds: 1
    # Wait 10 seconds between each round
    interval: 10s
    mode: "sequential"
    parallelcount: 1
  # This hosts section would cause iperf3 to be run from all hosts to the hosts selected in the `destinations` section
  # Each entry will be merged into one list
  hosts:
    clients:
    #- name: all-hosts
    #  all: true
    - name: one-randomly-selected-server
      random: true
      count: 1
    #  hostSelector:
    #    nope: foo
    #- name: all-hosts
    #  all: true
    #  hosts:
    #    - servers-0
    #    - servers-4
    servers:
    - name: one-randomly-selected-server
      random: true
      count: 1
    #  hostSelector:
    #    nope: foo
    #- name: different-hosts-1
    #  random: true
    #  count: 2 # When more than one hosts is wanted,
    #  hostSelector: # For Labels in K8s and Variables of hosts in Ansible
    #    network-tests-run-here: "true"
    #  antiAffinity:
    #    - openstack-region # This makes sure hosts with each different "openstack-region" are picked
    #- name: specific-hosts
    #  hosts:
    #    - serverabc123
    #    - serverxyz789
  iperf3:
    udp: false
    additionalFlags:
      clients: []
      server: []
#- type: siege
#  runOptions:
#    rounds: 5
#    interval: 15m
#  siege: {}
